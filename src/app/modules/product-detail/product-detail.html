<!-- product-detail.component.html -->
<div class="fixed inset-0 bg-black bg-opacity-60 z-40 backdrop-blur-sm transition-opacity duration-300" *ngIf="product"
    (click)="onClose()"></div>

<!-- Detail Card -->
<div class="fixed bottom-0 left-0 right-0 h-[90%] max-w-md mx-auto bg-white z-50 rounded-t-3xl shadow-xl"
    *ngIf="product">
    <!-- Handle untuk indikasi swipe -->
    <div class="w-16 h-1.5 bg-gray-300 rounded-full mx-auto mt-4 mb-3"></div>

    <!-- Area konten yang dapat di-scroll -->
    <div class="px-6 py-2 h-full overflow-y-auto pb-24 hide-scrollbar">
        <!-- Gambar produk dengan gradient overlay -->
        <div class="relative mb-4">
            <img [src]="product.imageUrl" [alt]="product.name" class="w-full h-64 object-cover rounded-xl shadow-md">

            <!-- Badges -->
            <div class="absolute top-3 left-3 flex flex-col gap-2">
                <span *ngIf="product.isNew"
                    class="bg-blue-500 text-white text-xs px-2.5 py-1 rounded-full font-medium shadow-sm">
                    Baru
                </span>
                <span *ngIf="product.isBestSeller"
                    class="bg-orange-500 text-white text-xs px-2.5 py-1 rounded-full font-medium shadow-sm">
                    Best Seller
                </span>
            </div>

            <!-- Discount Badge -->
            <div *ngIf="product.discount && product.discount > 0"
                class="absolute top-3 right-3 bg-red-500 text-white rounded-full h-12 w-12 flex items-center justify-center shadow-md">
                <span class="font-bold text-sm">-{{ product.discount }}%</span>
            </div>
        </div>

        <!-- Restaurant Info -->
        <div *ngIf="product.restaurant" class="flex items-center mb-4">
            <div class="w-10 h-10 bg-gray-100 rounded-full flex-shrink-0 overflow-hidden mr-3">
                <img *ngIf="product.restaurant.logo" [src]="product.restaurant.logo" class="w-full h-full object-cover"
                    alt="Restaurant logo">
                <div *ngIf="!product.restaurant.logo"
                    class="w-full h-full flex items-center justify-center bg-orange-100 text-orange-600 font-bold">
                    {{ product.restaurant.name.charAt(0) }}
                </div>
            </div>
            <div>
                <p class="text-sm font-semibold text-gray-800">{{ product.restaurant.name }}</p>
                <div *ngIf="product.restaurant.minDeliveryTime && product.restaurant.maxDeliveryTime"
                    class="flex items-center text-xs text-gray-500 mt-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ product.restaurant.minDeliveryTime }}-{{ product.restaurant.maxDeliveryTime }} menit
                </div>
            </div>
        </div>

        <!-- Informasi produk -->
        <div>
            <div class="flex items-start justify-between">
                <h2 class="text-2xl font-bold text-gray-800">{{ product.name }}</h2>

                <!-- Rating -->
                <div *ngIf="product.rating" class="flex items-center bg-orange-50 px-2 py-1 rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-orange-500" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <span class="ml-1 text-sm font-medium text-gray-700">{{ product.rating }}<span
                            class="text-xs text-gray-500"> ({{ product.reviewCount || 0 }})</span></span>
                </div>
            </div>

            <!-- Price -->
            <div class="flex items-center mt-2">
                <p class="text-orange-600 font-bold text-2xl">{{ product.price | currency:'Rp':'symbol':'1.0-0' }}</p>
                <p *ngIf="product.discount && product.discount > 0" class="ml-2 text-gray-500 text-sm line-through">
                    {{ (product.price / (1 - product.discount/100)) | currency:'Rp':'symbol':'1.0-0' }}
                </p>
            </div>

            <!-- Tags & Categories -->
            <div class="flex flex-wrap gap-2 mt-3">
                <span *ngIf="product.category"
                    class="bg-orange-100 text-orange-800 text-xs px-3 py-1.5 rounded-full font-medium">
                    {{ product.category.name }}
                </span>
                <span *ngFor="let tag of product.tags" [ngClass]="tag.colorClass || 'bg-gray-100 text-gray-800'"
                    class="text-xs px-3 py-1.5 rounded-full font-medium">
                    {{ tag.name }}
                </span>
            </div>

            <!-- Food Info Bar -->
            <div class="flex items-center gap-4 mt-5 bg-gray-50 p-3 rounded-xl">
                <div *ngIf="product.preparationTime" class="flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mb-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
                            clip-rule="evenodd" />
                    </svg>
                    <span class="text-xs font-medium text-gray-700">{{ product.preparationTime }} min</span>
                </div>
                <div *ngIf="product.calories" class="flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mb-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z"
                            clip-rule="evenodd" />
                    </svg>
                    <span class="text-xs font-medium text-gray-700">{{ product.calories }} kcal</span>
                </div>
                <div *ngIf="product.nutrition?.protein" class="flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 mb-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path
                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                </div>
            </div>

            <!-- Description -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Deskripsi</h3>
                <p class="text-gray-600 leading-relaxed">{{ product.description }}</p>
            </div>

            <!-- Allergens -->
            <div class="mt-6" *ngIf="product.allergens && product.allergens.length > 0">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Informasi Alergen</h3>
                <div class="flex flex-wrap gap-2">
                    <span *ngFor="let allergen of product.allergens"
                        class="bg-red-50 text-red-700 text-xs px-3 py-1.5 rounded-full font-medium">
                        {{ allergen }}
                    </span>
                </div>
            </div>

            <!-- Nutrition Info -->
            <div class="mt-6" *ngIf="product.nutrition">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Informasi Nutrisi</h3>
                <div class="bg-gray-50 rounded-xl p-4 space-y-3">
                    <div *ngIf="product.nutrition.calories" class="py-2 border-b border-gray-200 flex justify-between">
                        <span class="text-gray-600">Kalori</span>
                        <span class="text-gray-900 font-medium">{{ product.nutrition.calories }} kcal</span>
                    </div>
                    <div *ngIf="product.nutrition.protein" class="py-2 border-b border-gray-200 flex justify-between">
                        <span class="text-gray-600">Protein</span>
                        <span class="text-gray-900 font-medium">{{ product.nutrition.protein }}g</span>
                    </div>
                    <div *ngIf="product.nutrition.carbs" class="py-2 border-b border-gray-200 flex justify-between">
                        <span class="text-gray-600">Karbohidrat</span>
                        <span class="text-gray-900 font-medium">{{ product.nutrition.carbs }}g</span>
                    </div>
                    <div *ngIf="product.nutrition.fat" class="py-2 border-b border-gray-200 flex justify-between">
                        <span class="text-gray-600">Lemak</span>
                        <span class="text-gray-900 font-medium">{{ product.nutrition.fat }}g</span>
                    </div>
                    <div *ngIf="product.nutrition.fiber" class="py-2 flex justify-between">
                        <span class="text-gray-600">Serat</span>
                        <span class="text-gray-900 font-medium">{{ product.nutrition.fiber }}g</span>
                    </div>
                </div>
            </div>


            <!-- Options Section -->
            <div class="mt-6" *ngIf="product.options && product.options.length > 0">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Tambahan</h3>
                <div class="space-y-2">
                    <div *ngFor="let option of product.options"
                        class="flex items-center justify-between p-3 border border-gray-200 rounded-xl hover:border-orange-300 transition-colors duration-200">
                        <div class="flex items-center">
                            <input type="checkbox" [id]="'option-' + option.id" [checked]="option.isSelected"
                                class="w-4 h-4 text-orange-500 rounded-sm focus:ring-orange-500">
                            <label [for]="'option-' + option.id"
                                class="ml-3 text-sm font-medium text-gray-700 cursor-pointer">
                                {{ option.name }}
                            </label>
                        </div>
                        <span class="text-sm text-gray-600">
                            +{{ option.price | currency:'Rp':'symbol':'1.0-0' }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Special Instructions -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Instruksi Khusus</h3>
                <textarea placeholder="Contoh: tanpa bawang, level pedas sedang, dll."
                    class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-colors duration-200 text-sm"
                    rows="2"></textarea>
            </div>
        </div>
        <div class="h-28"></div> <!-- Spacer for bottom button -->
    </div>

    <div class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white border-t border-gray-200 p-5 shadow-md">
        <div class="flex items-center justify-between gap-4">
            <!-- Quantity Controls -->
            <div class="flex items-center space-x-3 bg-gray-50 rounded-xl px-3 py-2 shadow-sm">
                <button (click)="decreaseQuantity($event)"
                    class="w-9 h-9 flex items-center justify-center bg-white rounded-lg hover:bg-gray-100 transition-all duration-300 text-orange-600 font-medium border border-gray-100 shadow-sm"
                    [disabled]="quantity <= 1" [class.opacity-50]="quantity <= 1"
                    [class.cursor-not-allowed]="quantity <= 1">
                    -
                </button>

                <input type="text" [value]="quantity" readonly
                    class="w-10 text-center border-0 bg-transparent font-medium text-gray-800" />

                <button (click)="increaseQuantity($event)"
                    class="w-9 h-9 flex items-center justify-center bg-white rounded-lg hover:bg-gray-100 transition-all duration-300 text-orange-600 font-medium border border-gray-100 shadow-sm">
                    +
                </button>
            </div>

            <!-- Add to Cart Button -->
            <button (click)="addToCart()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-bold py-3.5 px-4 rounded-xl transition-all duration-300 
                        shadow-md hover:shadow-lg flex items-center justify-center" [disabled]="quantity === 0"
                [class.opacity-50]="quantity === 0" [class.cursor-not-allowed]="quantity === 0">
                <span>Tambahkan - {{ product.price * quantity | currency:'Rp':'symbol':'1.0-0' }}</span>
            </button>
        </div>
    </div>
</div>

<style>
    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .line-clamp-1 {
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>